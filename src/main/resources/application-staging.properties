# Staging environment configuration
# ------------------------------------------------
# Sensitive values moved to environment variables for security

# Use the S3 storage implementation
storage.type=s3

# S3 configuration - using environment variables
cloud.aws.credentials.access-key=${AWS_ACCESS_KEY}
cloud.aws.credentials.secret-key=${AWS_SECRET_KEY}
cloud.aws.region.static=${AWS_REGION:us-east-1}
cloud.aws.stack.auto=false

# S3 bucket configuration - using environment variables
cloud.aws.s3.bucket=${AWS_S3_BUCKET}
cloud.aws.s3.endpoint=${AWS_S3_ENDPOINT}

# Storage URL prefix - dynamic based on bucket
storage.url.prefix=https://${AWS_S3_BUCKET}.s3.us-west-2.amazonaws.com

# Server configuration
server.address=0.0.0.0
server.port=${PORT:8080}
# Removed server.servlet.context-path=/api to avoid double /api prefix

# Database Configuration - using environment variables
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://familynest-staging.cpi2sm2imd7p.us-west-2.rds.amazonaws.com:5432/familynest-staging}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.open-in-view=true

# Database connection pool optimization - adjusted to prevent timeouts after idle periods
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.auto-commit=false
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=10000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.keepalive-time=60000

# Logging configuration for staging
logging.level.com.familynest=INFO
logging.level.com.familynest.config.FirebaseConfig=DEBUG
logging.level.com.familynest.service.PushNotificationService=DEBUG
logging.level.com.familynest.config.DatabaseKeepAliveConfig=DEBUG

# Debug configuration loading
logging.level.org.springframework.boot.context.config=DEBUG
logging.level.com.zaxxer.hikari=DEBUG
logging.level.org.springframework.boot.autoconfigure=DEBUG
logging.level.com.familynest.controller.UserController=DEBUG

# Enhanced logging for database connection issues
logging.level.org.springframework.jdbc.core=DEBUG
logging.level.com.zaxxer.hikari.pool.HikariPool=DEBUG

# Flyway configuration
spring.flyway.out-of-order=true
spring.flyway.repair=true
spring.flyway.baseline-on-migrate=true
spring.liquibase.enabled=false
spring.flyway.enabled=true

# Email configuration - AWS SES SMTP
spring.mail.host=email-smtp.us-west-2.amazonaws.com
spring.mail.port=587
spring.mail.username=${SPRING_MAIL_USERNAME}
spring.mail.password=${SPRING_MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true

# Redis configuration
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=2000ms

# JWT configuration - using environment variables
jwt.secret=${JWT_SECRET}
# Extended token expiration times to prevent frequent logouts
# 7 days in milliseconds
jwt.access.expiration=604800000
# 90 days in milliseconds
jwt.refresh.expiration=7776000000
# 7 days in milliseconds (legacy)
jwt.expiration=604800000

# Application base URL - using environment variables
app.base-url=${APP_BASE_URL:https://infamilynest.com}

# Application configuration
app.use.ffmpeg=true
app.groupchat.max-participants=5

# Firebase Configuration (for debugging)
# Enhanced logging to debug 401 push notification errors

# Email testing configuration - redirect all emails to single address for testing
# Uncomment and set to your email to enable testing mode
# # email.testing.redirect=anthonypate@gmail.com

# File upload size limits
spring.servlet.multipart.max-file-size=25MB
spring.servlet.multipart.max-request-size=25MB
spring.servlet.multipart.enabled=true